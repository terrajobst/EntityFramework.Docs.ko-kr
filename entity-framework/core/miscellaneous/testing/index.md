---
title: EF Core를 사용하여 구성 요소 테스트 - EF Core
description: EF Core를 사용하는 애플리케이션을 테스트하는 다양한 방법
author: ajcvickers
ms.date: 03/23/2020
uid: core/miscellaneous/testing/index
ms.openlocfilehash: b1ab37ebb0a3aae09d5d5b225f746cf83dfba170
ms.sourcegitcommit: 9b562663679854c37c05fca13d93e180213fb4aa
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/07/2020
ms.locfileid: "80634247"
---
# <a name="testing-code-that-uses-ef-core"></a>EF Core를 사용하는 테스트 코드

데이터베이스에 액세스하는 코드를 테스트하려면 다음이 필요합니다.
* 프로덕션에 사용되는 동일한 데이터베이스 시스템에 대해 쿼리 및 업데이트 실행
* 관리하기가 좀 더 용이한 다른 데이터베이스 시스템에 대해 쿼리 및 업데이트 실행
* 이중 테스트 또는 데이터베이스를 사용하지 않는 기타 메커니즘 사용

이 문서에서는 이러한 각 선택 옵션에 포함된 장단점을 간략하게 설명하고 각 접근 방식에 EF Core를 사용하는 방법을 보여 줍니다.  

## <a name="all-database-providers-are-not-equal"></a>모든 데이터베이스 공급자가 같은 것은 아님

EF Core가 기본 데이터베이스 시스템의 모든 측면을 추상화하도록 디자인되지는 않았다는 사실을 이해하는 것은 매우 중요합니다.
대신, EF Core는 모든 데이터베이스 시스템에서 사용할 수 있는 일반적인 패턴 및 개념 세트입니다.
EF Core 데이터베이스 공급자는 이 공통 프레임워크에 대한 데이터베이스 관련 동작 및 기능을 계층화합니다.
이를 통해 적절한 경우 각 데이터베이스 시스템은 다른 데이터베이스 시스템과 공통된 측면을 유지하면서 최상의 작업 결과를 제공할 수 있습니다. 

기본적으로 데이터베이스 공급자를 전환할 경우 EF Core 동작이 변경되며 애플리케이션은 동작의 모든 차이점을 명확히 고려하지 못한다면 제대로 작동하지 못할 수 있습니다.
즉, 대부분의 경우 여러 관계형 데이터베이스가 상당한 공통점을 공유하므로 이러한 측면이 가능해집니다.
이러한 측면에는 장단점이 있습니다.
데이터베이스 간을 전환하기가 비교적 쉽다는 장점이 있습니다.
단점은 애플리케이션이 새 데이터베이스 시스템에 대해 완전히 테스트되지 않은 경우 잘못된 보안 인식을 제공할 수 있다는 것입니다.  

## <a name="approach-1-production-database-system"></a>방법 1: 프로덕션 데이터베이스 시스템

이전 섹션에서 설명한 것처럼 프로덕션 환경에서 실행되는 작업을 테스트하는 유일한 방법은 동일한 데이터베이스 시스템을 사용하는 것입니다.
예를 들어 배포된 애플리케이션이 SQL Azure를 사용하는 경우 SQL Azure에 대해서도 테스트를 수행해야 합니다.

그러나 모든 개발자가 실제로 코드 작업을 수행하면서 SQL Azure에 대해 테스트를 실행하도록 하면 작업이 느려지고 비용이 많이 들 수 있습니다.
이러한 사실은 이러한 방식 전반에 나타나는 주요 장단점을 나타냅니다. 테스트 효율성을 향상하기 위해 프로덕션 데이터베이스 시스템에서 언제 벗어나는 것이 적절할까요?

다행히 이 경우에는 답변하기 쉽습니다. 개발자 테스트를 위해 로컬 또는 온-프레미스 SQL Server를 사용하면 됩니다.
SQL Azure 및 SQL Server는 매우 유사하므로 일반적으로 SQL Server에 대해 테스트하는 것이 적절한 절충안입니다.
즉, 프로덕션으로 전환하기 전에 SQL Azure 자체에 대해 테스트를 실행하는 것이 좋습니다.
 
### <a name="localdb"></a>LocalDb 

모든 주요 데이터베이스 시스템에는 로컬 테스트를 위한 일종의 “Developer Edition”이 있습니다.
또한 SQL Server에는 [LocalDb](/sql/database-engine/configure-windows/sql-server-express-localdb?view=sql-server-ver15)라는 기능이 있습니다.
LocalDb의 주요 이점은 필요할 때 데이터베이스 인스턴스를 실행한다는 것입니다.
이렇게 하면 테스트를 실행하지 않는 경우에도 머신에서 데이터베이스 서비스를 계속 실행해야 하는 경우를 방지할 수 있습니다.

LocalDb에 문제가 없는 것도 아닙니다.
* [SQL Server Developer Edition](/sql/sql-server/editions-and-components-of-sql-server-2016?view=sql-server-ver15)이 지원하는 모든 기능을 지원하지는 않습니다.
* Linux에서는 사용할 수 없습니다.
* 서비스가 실행될 때 첫 번째 테스트 실행에서 지연이 발생할 수 있습니다.

개인적으로 데이터베이스 서비스를 개발 머신에서 실행할 때 문제가 확인된 적은 없으며 Developer Edition을 대신 사용하는 것이 좋습니다.
그러나 일부 사용자의 경우 덜 강력한 개발 머신에서 작업하는 것이 적절할 수 있습니다.  

## <a name="approach-2-sqlite"></a>방법 2: SQLite

EF Core는 주로 로컬 SQL Server 인스턴스에서 실행하여 여 SQL Server 공급자를 테스트합니다.
이러한 테스트는 고속 머신에서 몇 분 이내에 수만 개의 쿼리를 실행합니다.
이러한 테스트는 실제 데이터베이스 시스템을 사용하는 것이 보다 나은 성능을 제공하는 솔루션이라는 것을 보여 줍니다.
좀 더 경량의 데이터베이스를 사용하는 것이 테스트를 신속하게 실행하는 유일한 방법이라는 근거는 없습니다.

즉, 프로덕션 데이터베이스 시스템 가까이에 있는 항목에 대해 테스트를 실행할 수 없다면 어떻게 할까요?
다음 조건은 비슷한 기능을 가진 항목을 사용하는 것입니다.
일반적으로 다른 관계형 데이터베이스를 의미하므로 [SQLite](https://sqlite.org/index.html)를 선택하는 것이 적절합니다.

SQLite는 다음과 같은 이유로 적합합니다.
* 애플리케이션에서 In-Process로 실행되므로 오버헤드가 낮습니다.
* 데이터베이스에 대해 자동으로 생성되는 간단한 파일을 사용하므로 데이터베이스를 관리할 필요가 없습니다.
* 파일 생성도 방지하는 메모리 내 모드를 제공합니다.

그러나 다음 사항에 주의하세요.
* SQLite가 프로덕션 데이터베이스 시스템에서 수행하는 모든 작업을 반드시 지원하는 것은 아닙니다.
* SQLite는 일부 쿼리에 대해 프로덕션 데이터베이스 시스템과 다르게 동작합니다.

따라서 일부 테스트에 SQLite를 사용하는 경우 실제 데이터베이스 시스템에 대해서도 테스트를 수행해야 합니다.

EF Core 특정 지침은 [SQLite 테스트](xref:core/miscellaneous/testing/sqlite)를 참조하세요. 

## <a name="approach-3-the-ef-core-in-memory-database"></a>방법 3: EF Core 메모리 내 데이터베이스

EF Core는 EF Core 자체의 내부 테스트에 사용되는 메모리 내 데이터베이스와 함께 제공됩니다.
이 데이터베이스는 일반적으로 **EF Core를 사용하는 테스트 애플리케이션을 대신하기에는 적합하지 않습니다**. 구체적으로는 다음과 같습니다.
* 관계형 데이터베이스가 아닙니다.
* 트랜잭션을 지원하지 않습니다.
* 성능에 대해 최적화되지 않았습니다.

특히 데이터베이스가 테스트와 관련이 없는 경우 사용하기 때문에 EF Core 내부 테스트에는 별로 중요하지 않습니다.
반면, EF Core를 사용하는 애플리케이션을 테스트할 때는 매우 중요합니다.

## <a name="unit-testing"></a>단위 테스트

데이터베이스의 일부 데이터를 사용해야 할 수 있지만 기본적으로 데이터베이스 상호 작용을 테스트하지 않는 비즈니스 논리를 테스트하는 것이 좋습니다.
한 가지 옵션은 모의 또는 가짜와 같은 [이중 테스트](https://en.wikipedia.org/wiki/Test_double)를 사용하는 것입니다.

EF Core의 내부 테스트를 위해 이중 테스트를 사용합니다.
그러나 DbContext 또는 IQueryable을 모의로 테스트해서는 안 됩니다.
이 작업을 수행하는 것은 어렵고 번거로우며 허술할 수 있습니다.
**따라서 피해야 합니다.**

대신 DbContext를 사용하여 단위 테스트를 수행할 때 메모리 내 데이터베이스를 사용합니다.
이 경우 테스트가 데이터베이스 동작에 따라 좌우되지 않으므로 메모리 내 데이터베이스를 사용하는 것이 적합합니다.
이 테스트를 통해 실제 데이터베이스 쿼리나 업데이트를 테스트하지는 마세요.   

단위 테스트에 메모리 내 데이터베이스를 사용하는 방법에 대한 EF Core 관련 지침은 [메모리 내 공급자 테스트](xref:core/miscellaneous/testing/in-memory)를 참조하세요.
